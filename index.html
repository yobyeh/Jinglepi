<!DOCTYPE html>
<html>
    <head>
        <title>LED Color Control</title>
        <style>
            /* Style for the grid container */
            .grid {
                display: grid;
                grid-template-rows: repeat(50, 14px); /* 50 squares per row */
                grid-auto-flow: column; /* Flow squares into columns */
                row-gap: 0px; /* Adjust the vertical spacing between rows */
                column-gap: 2px; /* Optional: Adjust the horizontal spacing between columns */
                margin: 20px auto;
                justify-content: center;
            }
            /* Style for each square */
            .square {
                width: 10px;
                height: 10px;
                line-height: 0; /* Reset line height */
                background-color: #000; /* Default color: black */
                border: 1px solid #ccc;
            }
        </style>
    </head>
    <body>
        <h1>LED Color Controller</h1>
        <input type="color" id="colorPicker" value="#ff0000" style="width:100%; height:100px;"/>
        <div class="grid" id="grid"></div> <!-- Grid container -->
        <script>
            const ws = new WebSocket("ws://192.168.1.17:8000/ws");

            // Send color to the WebSocket when the color picker changes
            document.getElementById("colorPicker").addEventListener("input", (event) => {
                const color = event.target.value;
                ws.send(color);
            });

            // Update the color square with the current LED color
            ws.onmessage = (event) => {
            const color = event.data; // Get the color from the server
            const colorDisplay = document.getElementById("colorDisplay");
            colorDisplay.style.backgroundColor = color; // Update the square's color
            };

            // Create the grid dynamically
            const gridContainer = document.getElementById("grid");
            for (let i = 0; i < 50 * 16; i++) {
                const square = document.createElement("div");
                square.classList.add("square");
                gridContainer.appendChild(square);
            }

            // Update the grid based on the received matrix
            ws.onmessage = (event) => {
                const matrix = JSON.parse(event.data); // Parse the matrix data
                const squares = document.getElementsByClassName("square");


                // Loop through the matrix and update squares
                for (let col = 0; col < 16; col++) {
                    for (let row = 0; row < 50; row++) {
                        const index = col * 50 + row; // Calculate square index for column-major order
                        const color = matrix[row][col] === 0 ? "#000000" : "#ffffff"; // Example: 0 = black, 1 = white
                        squares[index].style.backgroundColor = color;
                    }
                }
            };

            ws.onopen = () => {
                console.log("WebSocket connection established");
            };

            ws.onclose = () => {
                console.log("WebSocket connection closed");
            };
        </script>
    </body>
</html>
"""